// automatically generated by Xtext
grammar xtext.Securitymodels with org.eclipse.xtext.common.Terminals

import "platform:/resource/securitymodels/metamodels/securitymodels.ecore" 
import "http://www.eclipse.org/emf/2002/Ecore" as ecore
import "platform:/resource/datamodels/metamodels/datamodels.ecore" as datamodels

SecurityModel returns SecurityModel: {SecurityModel}
	'name:' name=EString
	'protected:' resources+=ProtectedResource ("," resources+=ProtectedResource)*
	'roles:' (roles+=Role)+
	('rules:' (rules+=Rule)+)?;

EString returns ecore::EString:
	STRING | ID;

Rule returns Rule:
	name=EString
	':'
	action=Action
	'conditions'
	('{' auths+=Auth ( "or" auths+=Auth)* '}' )?;

Role returns Role:
	name=EString
	'<-'
	userEntity=[datamodels::Entity|EString];

enum Action returns Action:
				READ = 'READ' | CREATE = 'CREATE' | UPDATE = 'UPDATE' | DELETE = 'DELETE';

Auth returns Auth:
	'{'
		'roles' '(' roles+=[Role|EString] ( "," roles+=[Role|EString])* ')' 
		'context:' textual=EString
		'ocl:' oclExp=EString
		'sql:' sqlStm=EString
	'}';
	
ProtectedResource returns ProtectedResource:
	'('
		property=[datamodels::Property|EString]
		'as' 
		name=EString
	')';
