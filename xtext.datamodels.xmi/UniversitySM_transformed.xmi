<?xml version="1.0" encoding="ASCII"?>
<securitymodels:SecurityModel xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:securitymodels="/final/metamodel/securitymodels.ecore" xsi:schemaLocation="/final/metamodel/securitymodels.ecore ../securitymodels/metamodels/securitymodels.ecore" name="University">
  <rules name="readBasicInfo" protectedResources="//@resources.0">
    <auths textual="Any one with a role can read any registered user basic information" oclExp="true" sqlStm="TRUE" roles="//@roles.2"/>
  </rules>
  <rules name="readStudentSpecificInfo" protectedResources="//@resources.3">
    <auths textual="Student can read its classmates' intake year" oclExp="caller.enrolled->exists(c|c.students->includes(self))" sqlStm="caller = self" roles="//@roles.2"/>
  </rules>
  <rules name="readLecturerSpecificInfo" protectedResources="//@resources.2">
    <auths textual="Lecturer can read its own salary" oclExp="true" sqlStm="TRUE" roles="//@roles.1"/>
  </rules>
  <rules name="readStudentSpecificInfo" protectedResources="//@resources.3">
    <auths textual="Lecturer can read its students' intake year" oclExp="caller.taught->exists(c|c.students->includes(self))" sqlStm="EXISTS (SELECT 1 FROM (SELECT * FROM teaching WHERE lecturer = caller) as TEMP1 JOIN (SELECT * FROM enrollment WHERE students = self) as TEMP2 ON TEMP1.taught = TEMP2.enrolled)" roles="//@roles.1"/>
  </rules>
  <rules name="readBasicInfo" protectedResources="//@resources.0">
    <auths textual="Any one with a role can read any registered user basic information" oclExp="true" sqlStm="TRUE" roles="//@roles.1"/>
  </rules>
  <rules name="readStudentSpecificInfo" protectedResources="//@resources.3">
    <auths textual="Administrator can read any student intake year" oclExp="true" sqlStm="TRUE" roles="//@roles.0"/>
  </rules>
  <rules name="readBasicInfo" protectedResources="//@resources.0">
    <auths textual="Any one with a role can read any registered user basic information" oclExp="true" sqlStm="TRUE" roles="//@roles.0"/>
  </rules>
  <rules name="readBasicInfo" protectedResources="//@resources.1">
    <auths textual="Any one with a role can read any registered user basic information" oclExp="true" sqlStm="TRUE" roles="//@roles.2"/>
  </rules>
  <rules name="readBasicInfo" protectedResources="//@resources.1">
    <auths textual="Any one with a role can read any registered user basic information" oclExp="true" sqlStm="TRUE" roles="//@roles.1"/>
  </rules>
  <rules name="readBasicInfo" protectedResources="//@resources.1">
    <auths textual="Any one with a role can read any registered user basic information" oclExp="true" sqlStm="TRUE" roles="//@roles.0"/>
  </rules>
  <roles name="Administrator">
    <userEntity href="University.sm#|11"/>
  </roles>
  <roles name="Lecturer">
    <userEntity href="University.sm#|12"/>
  </roles>
  <roles name="Student">
    <userEntity href="University.sm#|13"/>
  </roles>
  <resources name="regUserEmail"/>
  <resources name="regUserName"/>
  <resources name="lecturerSalary"/>
  <resources name="studentIntake"/>
</securitymodels:SecurityModel>
